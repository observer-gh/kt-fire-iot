<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©€í‹° ì†Œì¼“ WebSocket í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .socket-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .socket-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        .socket-panel.active {
            border-color: #28a745;
            box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
        }
        .socket-panel.inactive {
            border-color: #dc3545;
            opacity: 0.7;
        }
        .socket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        .socket-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .socket-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .socket-status.connected {
            background: #d4edda;
            color: #155724;
        }
        .socket-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        .socket-status.connecting {
            background: #fff3cd;
            color: #856404;
        }
        .controls {
            margin: 15px 0;
            text-align: center;
        }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 3px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid #e9ecef;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .message-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        .log-title {
            font-weight: bold;
            color: #333;
        }
        .log-count {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            border-left: 3px solid #007bff;
            background: white;
        }
        .log-entry.frame {
            border-left-color: #28a745;
            background: #f8fff9;
        }
        .log-entry.error {
            border-left-color: #dc3545;
            background: #fff8f8;
            color: #721c24;
        }
        .log-entry.info {
            border-left-color: #17a2b8;
            background: #f8f9fa;
        }
        .global-controls {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .global-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .global-stat {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .global-stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .global-stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        .comparison-panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        .comparison-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        .highlight {
            background: #fff3cd !important;
            font-weight: bold;
        }
        .timestamp {
            color: #666;
            font-size: 11px;
        }
        .message-type {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: bold;
            margin-right: 5px;
        }
        .message-type.frame {
            background: #d4edda;
            color: #155724;
        }
        .message-type.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        .message-type.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ ë©€í‹° ì†Œì¼“ WebSocket í…ŒìŠ¤íŠ¸</h1>
            <p>í•˜ë‚˜ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ë‘ ê°œì˜ WebSocket ì†Œì¼“ì´ ë™ì¼í•œ í† í”½ì„ ìˆ˜ì‹ í•˜ëŠ” í…ŒìŠ¤íŠ¸</p>
        </div>

        <div class="global-controls">
            <h3>ğŸŒ ì „ì—­ ì œì–´</h3>
            <button class="btn btn-success" onclick="connectAllSockets()">ëª¨ë“  ì†Œì¼“ ì—°ê²°</button>
            <button class="btn btn-danger" onclick="disconnectAllSockets()">ëª¨ë“  ì†Œì¼“ í•´ì œ</button>
            <button class="btn btn-warning" onclick="clearAllLogs()">ëª¨ë“  ë¡œê·¸ ì‚­ì œ</button>
            <button class="btn" onclick="startStreaming()">ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘</button>
            <button class="btn" onclick="stopStreaming()">ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€</button>
        </div>

        <div class="global-stats">
            <div class="global-stat">
                <div class="global-stat-value" id="totalMessages">0</div>
                <div class="global-stat-label">ì´ ë©”ì‹œì§€ ìˆ˜</div>
            </div>
            <div class="global-stat">
                <div class="global-stat-value" id="activeSockets">0</div>
                <div class="global-stat-label">í™œì„± ì†Œì¼“ ìˆ˜</div>
            </div>
            <div class="global-stat">
                <div class="global-stat-value" id="totalFrames">0</div>
                <div class="global-stat-label">ì´ í”„ë ˆì„ ìˆ˜</div>
            </div>
            <div class="global-stat">
                <div class="global-stat-value" id="avgLatency">0ms</div>
                <div class="global-stat-label">í‰ê·  ì§€ì—°ì‹œê°„</div>
            </div>
        </div>

        <div class="socket-container">
            <!-- ì†Œì¼“ 1 -->
            <div class="socket-panel" id="socket1-panel">
                <div class="socket-header">
                    <div class="socket-title">ğŸ”Œ ì†Œì¼“ 1 (Socket-1)</div>
                    <span class="socket-status disconnected" id="socket1-status">ì—°ê²° í•´ì œë¨</span>
                </div>
                
                <div class="controls">
                    <button class="btn btn-success" onclick="connectSocket(1)">ì—°ê²°</button>
                    <button class="btn btn-danger" onclick="disconnectSocket(1)">í•´ì œ</button>
                    <button class="btn" onclick="clearLog(1)">ë¡œê·¸ ì‚­ì œ</button>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">ë©”ì‹œì§€ ìˆ˜</div>
                        <div class="stat-value" id="socket1-message-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">í”„ë ˆì„ ìˆ˜</div>
                        <div class="stat-value" id="socket1-frame-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ë§ˆì§€ë§‰ ìˆ˜ì‹ </div>
                        <div class="stat-value" id="socket1-last-received">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ì—°ê²° ì‹œê°„</div>
                        <div class="stat-value" id="socket1-connection-time">-</div>
                    </div>
                </div>

                <div class="message-log">
                    <div class="log-header">
                        <span class="log-title">ë©”ì‹œì§€ ë¡œê·¸</span>
                        <span class="log-count" id="socket1-log-count">0</span>
                    </div>
                    <div id="socket1-log-container"></div>
                </div>
            </div>

            <!-- ì†Œì¼“ 2 -->
            <div class="socket-panel" id="socket2-panel">
                <div class="socket-header">
                    <div class="socket-title">ğŸ”Œ ì†Œì¼“ 2 (Socket-2)</div>
                    <span class="socket-status disconnected" id="socket2-status">ì—°ê²° í•´ì œë¨</span>
                </div>
                
                <div class="controls">
                    <button class="btn btn-success" onclick="connectSocket(2)">ì—°ê²°</button>
                    <button class="btn btn-danger" onclick="disconnectSocket(2)">í•´ì œ</button>
                    <button class="btn" onclick="clearLog(2)">ë¡œê·¸ ì‚­ì œ</button>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">ë©”ì‹œì§€ ìˆ˜</div>
                        <div class="stat-value" id="socket2-message-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">í”„ë ˆì„ ìˆ˜</div>
                        <div class="stat-value" id="socket2-frame-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ë§ˆì§€ë§‰ ìˆ˜ì‹ </div>
                        <div class="stat-value" id="socket2-last-received">-</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">ì—°ê²° ì‹œê°„</div>
                        <div class="stat-value" id="socket2-connection-time">-</div>
                    </div>
                </div>

                <div class="message-log">
                    <div class="log-header">
                        <span class="log-title">ë©”ì‹œì§€ ë¡œê·¸</span>
                        <span class="log-count" id="socket2-log-count">0</span>
                    </div>
                    <div id="socket2-log-container"></div>
                </div>
            </div>
        </div>

        <div class="comparison-panel">
            <h3>ğŸ“Š ì†Œì¼“ ë¹„êµ ë¶„ì„</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ì†Œì¼“ 1</th>
                        <th>ì†Œì¼“ 2</th>
                        <th>ì°¨ì´</th>
                        <th>ìƒíƒœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ë©”ì‹œì§€ ìˆ˜</td>
                        <td id="comp-socket1-messages">0</td>
                        <td id="comp-socket2-messages">0</td>
                        <td id="comp-message-diff">0</td>
                        <td id="comp-message-status">-</td>
                    </tr>
                    <tr>
                        <td>í”„ë ˆì„ ìˆ˜</td>
                        <td id="comp-socket1-frames">0</td>
                        <td id="comp-socket2-frames">0</td>
                        <td id="comp-frame-diff">0</td>
                        <td id="comp-frame-status">-</td>
                    </tr>
                    <tr>
                        <td>ì—°ê²° ì‹œê°„</td>
                        <td id="comp-socket1-time">-</td>
                        <td id="comp-socket2-time">-</td>
                        <td id="comp-time-diff">-</td>
                        <td id="comp-time-status">-</td>
                    </tr>
                    <tr>
                        <td>ë§ˆì§€ë§‰ ìˆ˜ì‹ </td>
                        <td id="comp-socket1-last">-</td>
                        <td id="comp-socket2-last">-</td>
                        <td id="comp-last-diff">-</td>
                        <td id="comp-last-status">-</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let socket1 = null;
        let socket2 = null;
        let globalStats = {
            totalMessages: 0,
            activeSockets: 0,
            totalFrames: 0,
            totalLatency: 0,
            latencyCount: 0
        };

        // ì†Œì¼“ ìƒíƒœ ê´€ë¦¬
        const socketStates = {
            1: { connected: false, messageCount: 0, frameCount: 0, lastReceived: '-', connectionTime: '-' },
            2: { connected: false, messageCount: 0, frameCount: 0, lastReceived: '-', connectionTime: '-' }
        };

        // ì†Œì¼“ ì—°ê²°
        function connectSocket(socketNum) {
            const socket = new SockJS('/cctv-websocket');
            const stompClient = Stomp.over(socket);
            
            updateSocketStatus(socketNum, 'connecting');
            
            stompClient.connect({}, function (frame) {
                console.log(`ì†Œì¼“ ${socketNum} ì—°ê²° ì„±ê³µ:`, frame);
                
                // CCTV ìŠ¤íŠ¸ë¦¼ êµ¬ë…
                stompClient.subscribe('/topic/cctv-stream', function (message) {
                    const frameData = JSON.parse(message.body);
                    handleMessage(socketNum, frameData);
                });
                
                // ì†Œì¼“ ì €ì¥
                if (socketNum === 1) {
                    socket1 = stompClient;
                } else {
                    socket2 = stompClient;
                }
                
                updateSocketStatus(socketNum, 'connected');
                updateSocketStats(socketNum, 'connectionTime', new Date().toLocaleTimeString());
                
                addLog(socketNum, 'WebSocket ì—°ê²° ì„±ê³µ', 'info');
                
            }, function (error) {
                console.error(`ì†Œì¼“ ${socketNum} ì—°ê²° ì‹¤íŒ¨:`, error);
                updateSocketStatus(socketNum, 'disconnected');
                addLog(socketNum, `WebSocket ì—°ê²° ì‹¤íŒ¨: ${error}`, 'error');
            });
        }

        // ì†Œì¼“ í•´ì œ
        function disconnectSocket(socketNum) {
            let stompClient = null;
            if (socketNum === 1) {
                stompClient = socket1;
                socket1 = null;
            } else {
                stompClient = socket2;
                socket2 = null;
            }
            
            if (stompClient) {
                stompClient.disconnect();
                addLog(socketNum, 'WebSocket ì—°ê²° í•´ì œ', 'info');
            }
            
            updateSocketStatus(socketNum, 'disconnected');
            updateSocketStats(socketNum, 'connectionTime', '-');
        }

        // ëª¨ë“  ì†Œì¼“ ì—°ê²°
        function connectAllSockets() {
            connectSocket(1);
            connectSocket(2);
        }

        // ëª¨ë“  ì†Œì¼“ í•´ì œ
        function disconnectAllSockets() {
            disconnectSocket(1);
            disconnectSocket(2);
        }

        // ë©”ì‹œì§€ ì²˜ë¦¬
        function handleMessage(socketNum, frameData) {
            const receiveTime = new Date();
            const timestamp = receiveTime.toLocaleTimeString();
            
            // ë©”ì‹œì§€ ìˆ˜ ì¦ê°€
            socketStates[socketNum].messageCount++;
            socketStates[socketNum].lastReceived = timestamp;
            
            // í”„ë ˆì„ ìˆ˜ ì¦ê°€ (ë¹„ë””ì˜¤ í”„ë ˆì„ì¸ ê²½ìš°)
            if (frameData.type === 'video_frame') {
                socketStates[socketNum].frameCount++;
                globalStats.totalFrames++;
                
                // ì§€ì—°ì‹œê°„ ê³„ì‚° (ì„œë²„ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ë¹„êµ)
                if (frameData.timestamp) {
                    const latency = receiveTime.getTime() - frameData.timestamp;
                    globalStats.totalLatency += latency;
                    globalStats.latencyCount++;
                }
            }
            
            // ì „ì—­ í†µê³„ ì—…ë°ì´íŠ¸
            globalStats.totalMessages++;
            
            // UI ì—…ë°ì´íŠ¸
            updateSocketStats(socketNum, 'messageCount', socketStates[socketNum].messageCount);
            updateSocketStats(socketNum, 'frameCount', socketStates[socketNum].frameCount);
            updateSocketStats(socketNum, 'lastReceived', timestamp);
            updateGlobalStats();
            updateComparisonTable();
            
            // ë¡œê·¸ ì¶”ê°€
            if (frameData.type === 'video_frame') {
                addLog(socketNum, `í”„ë ˆì„ ìˆ˜ì‹ : ${frameData.frameNumber} (${frameData.videoPath})`, 'frame');
            } else {
                addLog(socketNum, `ë©”ì‹œì§€ ìˆ˜ì‹ : ${JSON.stringify(frameData)}`, 'info');
            }
        }

        // ì†Œì¼“ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSocketStatus(socketNum, status) {
            const statusElement = document.getElementById(`socket${socketNum}-status`);
            const panelElement = document.getElementById(`socket${socketNum}-panel`);
            
            socketStates[socketNum].connected = (status === 'connected');
            
            statusElement.textContent = getStatusText(status);
            statusElement.className = `socket-status ${status}`;
            
            // íŒ¨ë„ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
            panelElement.className = `socket-panel ${status}`;
            
            // ì „ì—­ í†µê³„ ì—…ë°ì´íŠ¸
            updateGlobalStats();
        }

        // ìƒíƒœ í…ìŠ¤íŠ¸ ë³€í™˜
        function getStatusText(status) {
            switch (status) {
                case 'connected': return 'ì—°ê²°ë¨';
                case 'disconnected': return 'ì—°ê²° í•´ì œë¨';
                case 'connecting': return 'ì—°ê²° ì¤‘...';
                default: return 'ì•Œ ìˆ˜ ì—†ìŒ';
            }
        }

        // ì†Œì¼“ í†µê³„ ì—…ë°ì´íŠ¸
        function updateSocketStats(socketNum, statType, value) {
            const element = document.getElementById(`socket${socketNum}-${statType.replace(/([A-Z])/g, '-$1').toLowerCase()}`);
            if (element) {
                element.textContent = value;
            }
        }

        // ì „ì—­ í†µê³„ ì—…ë°ì´íŠ¸
        function updateGlobalStats() {
            document.getElementById('totalMessages').textContent = globalStats.totalMessages;
            document.getElementById('activeSockets').textContent = 
                (socketStates[1].connected ? 1 : 0) + (socketStates[2].connected ? 1 : 0);
            document.getElementById('totalFrames').textContent = globalStats.totalFrames;
            
            const avgLatency = globalStats.latencyCount > 0 ? 
                Math.round(globalStats.totalLatency / globalStats.latencyCount) : 0;
            document.getElementById('avgLatency').textContent = `${avgLatency}ms`;
        }

        // ë¹„êµ í…Œì´ë¸” ì—…ë°ì´íŠ¸
        function updateComparisonTable() {
            // ë©”ì‹œì§€ ìˆ˜ ë¹„êµ
            const messageDiff = Math.abs(socketStates[1].messageCount - socketStates[2].messageCount);
            document.getElementById('comp-socket1-messages').textContent = socketStates[1].messageCount;
            document.getElementById('comp-socket2-messages').textContent = socketStates[2].messageCount;
            document.getElementById('comp-message-diff').textContent = messageDiff;
            document.getElementById('comp-message-status').textContent = 
                messageDiff === 0 ? 'ë™ê¸°í™”ë¨' : 'ì°¨ì´ ìˆìŒ';
            
            // í”„ë ˆì„ ìˆ˜ ë¹„êµ
            const frameDiff = Math.abs(socketStates[1].frameCount - socketStates[2].frameCount);
            document.getElementById('comp-socket1-frames').textContent = socketStates[1].frameCount;
            document.getElementById('comp-socket2-frames').textContent = socketStates[2].frameCount;
            document.getElementById('comp-frame-diff').textContent = frameDiff;
            document.getElementById('comp-frame-status').textContent = 
                frameDiff === 0 ? 'ë™ê¸°í™”ë¨' : 'ì°¨ì´ ìˆìŒ';
            
            // ì—°ê²° ì‹œê°„ ë¹„êµ
            document.getElementById('comp-socket1-time').textContent = socketStates[1].connectionTime;
            document.getElementById('comp-socket2-time').textContent = socketStates[2].connectionTime;
            document.getElementById('comp-time-diff').textContent = '-';
            document.getElementById('comp-time-status').textContent = '-';
            
            // ë§ˆì§€ë§‰ ìˆ˜ì‹  ì‹œê°„ ë¹„êµ
            document.getElementById('comp-socket1-last').textContent = socketStates[1].lastReceived;
            document.getElementById('comp-socket2-last').textContent = socketStates[2].lastReceived;
            document.getElementById('comp-last-diff').textContent = '-';
            document.getElementById('comp-last-status').textContent = '-';
            
            // í•˜ì´ë¼ì´íŠ¸ ì²˜ë¦¬
            highlightDifferences();
        }

        // ì°¨ì´ì  í•˜ì´ë¼ì´íŠ¸
        function highlightDifferences() {
            const rows = document.querySelectorAll('.comparison-table tbody tr');
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length >= 4) {
                    const diffCell = cells[3];
                    const statusCell = cells[4];
                    
                    if (diffCell.textContent !== '0' && diffCell.textContent !== '-') {
                        row.classList.add('highlight');
                    } else {
                        row.classList.remove('highlight');
                    }
                }
            });
        }

        // ë¡œê·¸ ì¶”ê°€
        function addLog(socketNum, message, type = 'info') {
            const logContainer = document.getElementById(`socket${socketNum}-log-container`);
            const logCountElement = document.getElementById(`socket${socketNum}-log-count`);
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            const typeLabel = getTypeLabel(type);
            
            logEntry.innerHTML = `
                <span class="timestamp">[${timestamp}]</span>
                <span class="message-type ${type}">${typeLabel}</span>
                ${message}
            `;
            
            logContainer.appendChild(logEntry);
            
            // ë¡œê·¸ ìˆ˜ ì—…ë°ì´íŠ¸
            const currentCount = logContainer.children.length;
            logCountElement.textContent = currentCount;
            
            // ìë™ ìŠ¤í¬ë¡¤
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // ìµœëŒ€ 100ê°œ ë¡œê·¸ ìœ ì§€
            if (currentCount > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // íƒ€ì… ë¼ë²¨ ë³€í™˜
        function getTypeLabel(type) {
            switch (type) {
                case 'frame': return 'FRAME';
                case 'error': return 'ERROR';
                case 'info': return 'INFO';
                default: return 'LOG';
            }
        }

        // ë¡œê·¸ ì‚­ì œ
        function clearLog(socketNum) {
            const logContainer = document.getElementById(`socket${socketNum}-log-container`);
            const logCountElement = document.getElementById(`socket${socketNum}-log-count`);
            
            logContainer.innerHTML = '';
            logCountElement.textContent = '0';
        }

        // ëª¨ë“  ë¡œê·¸ ì‚­ì œ
        function clearAllLogs() {
            clearLog(1);
            clearLog(2);
        }

        // ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
        function startStreaming() {
            fetch('/api/cctv/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLog(1, 'ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ìš”ì²­ ì„±ê³µ', 'info');
                    addLog(2, 'ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ìš”ì²­ ì„±ê³µ', 'info');
                } else {
                    addLog(1, 'ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ì‹¤íŒ¨: ' + data.message, 'error');
                    addLog(2, 'ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ì‹¤íŒ¨: ' + data.message, 'error');
                }
            })
            .catch(error => {
                addLog(1, 'ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ìš”ì²­ ì˜¤ë¥˜: ' + error, 'error');
                addLog(2, 'ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ ìš”ì²­ ì˜¤ë¥˜: ' + error, 'error');
            });
        }

        // ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€
        function stopStreaming() {
            fetch('/api/cctv/stop', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    addLog(1, 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ìš”ì²­ ì„±ê³µ', 'info');
                    addLog(2, 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ìš”ì²­ ì„±ê³µ', 'info');
                } else {
                    addLog(1, 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ì‹¤íŒ¨: ' + data.message, 'error');
                    addLog(2, 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ì‹¤íŒ¨: ' + data.message, 'error');
                }
            })
            .catch(error => {
                addLog(1, 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ìš”ì²­ ì˜¤ë¥˜: ' + error, 'error');
                addLog(2, 'ìŠ¤íŠ¸ë¦¬ë° ì¤‘ì§€ ìš”ì²­ ì˜¤ë¥˜: ' + error, 'error');
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            addLog(1, 'ë©€í‹° ì†Œì¼“ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨', 'info');
            addLog(2, 'ë©€í‹° ì†Œì¼“ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨', 'info');
            updateGlobalStats();
            updateComparisonTable();
        };

        // í˜ì´ì§€ ì¢…ë£Œ ì‹œ ì—°ê²° í•´ì œ
        window.onbeforeunload = function() {
            disconnectAllSockets();
        };
    </script>
</body>
</html>
